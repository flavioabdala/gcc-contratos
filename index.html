<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestão de Contratos</title>
</head>
<body>
  <h1>Gestão de Contratos</h1>

  <div id="auth-section">
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Senha" />
    <button id="login-btn">Login</button>
    <button id="register-btn">Registrar</button>
    <button id="logout-btn" style="display:none;">Sair</button>
  </div>

  <div id="app-section" style="display:none;">
    <h2>Registrar Contrato</h2>
    <input type="text" id="empresa" placeholder="Nome da Empresa" />
    <input type="text" id="objeto" placeholder="Objeto da Contratação" />
    <button id="add-contrato">Adicionar Contrh3>Contratos Registrados</h3>
    <ul id="lista-contratos"></ul>

    <h2>Meus Lembretes</h2>
    <input type="text" id="lembrete" placeholder="Novo Lembrete" />
    <button id="add-lembrete">Adicionar Lembrete</button>

    <h3>Lembretes</h3>
    <ul id="lista-lembretes"></ul>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDTxRQdMy4QugmySVeSErf5Kqihn_4OhWw",
      authDomain: "gcc-contratos.firebaseapp.com",
      projectId: "gcc-contratos",
      storageBucket: "gcc-contratos.firebasestorage.app",
      messagingSenderId: "405415511927",
      appId: "1:405415511927:web:4612190119302726820372",
      measurementId: "G-T1T4N9WD5T"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const loginBtn = document.getElementById("login-btn");
    const registerBtn = document.getElementById("register-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const authSection = document.getElementById("auth-section");
    const appSection = document.getElementById("app-section");

    const empresa = document.getElementById("empresa");
    const objeto = document.getElementById("objeto");
    const addContrato = document.getElementById("add-contrato");
    const listaContratos = document.getElementById("lista-contratos");

    const lembrete = document.getElementById("lembrete");
    const addLembrete = document.getElementById("add-lembrete");
    const listaLembretes = document.getElementById("lista-lembretes");

    loginBtn.onclick = () => {
      signInWithEmailAndPassword(auth, email.value, password.value)
        .catch(err => alert("Erro no login: " + err.message));
    };

    registerBtn.onclick = () => {
      createUserWithEmailAndPassword(auth, email.value, password.value)
        .catch(err => alert("Erro no registro: " + err.message));
    };

    logoutBtn.onclick = () => {
      signOut(auth);
    };

    onAuthStateChanged(auth, user => {
      if (user) {
        authSection.style.display = "none";
        appSection.style.display = "block";
        logoutBtn.style.display = "inline";
        carregarContratos(user.uid);
        carregarLembretes(user.uid);
      } else {
        authSection.style.display = "block";
        appSection.style.display = "none";
        logoutBtn.style.display = "none";
      }
    });

    addContrato.onclick = async () => {
      const user = auth.currentUser;
      if (!user) return;

      await addDoc(collection(db, "contratos"), {
        uid: user.uid,
        empresa: empresa.value,
        objeto: objeto.value,
        timestamp: Date.now()
      });

      empresa.value = "";
      objeto.value = "";
      carregarContratos(user.uid);
    };

    async function carregarContratos(uid) {
      listaContratos.innerHTML = "";
      const q = query(collection(db, "contratos"), where("uid", "==", uid));
      const snapshot = await getDocs(q);
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = `${doc.data().empresa} - ${doc.data().objeto}`;
        listaContratos.appendChild(li);
      });
    }

    addLembrete.onclick = async () => {
      const user = auth.currentUser;
      if (!user) return;

      await addDoc(collection(db, "lembretes"), {
        uid: user.uid,
        texto: lembrete.value,
        timestamp: Date.now()
      });

      lembrete.value = "";
      carregarLembretes(user.uid);
    };

    async function carregarLembretes(uid) {
      listaLembretes.innerHTML = "";
      const q = query(collection(db, "lembretes"), where("uid", "==", uid));
      const snapshot = await getDocs(q);
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = doc.data().texto;
        listaLembretes.appendChild(li);
      });
    }
  </script>
</body>
</html>
